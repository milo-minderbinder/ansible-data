export BASH_SILENCE_DEPRECATION_WARNING=1

for path_entry in '/usr/local/bin' '/usr/local/sbin'; do
	if [ -z "$(printf "${PATH}" | tr ':' '\n' | grep "^${path_entry}")" ]; then
		printf 'Adding %s to the PATH\n' "${path_entry}" >&2
		export PATH="${path_entry}:$PATH"
	fi
done

# Java config
{% if 'zulu7' in cask_apps %}
export JAVA7="$(/usr/libexec/java_home -v 1.7)"
{% endif %}
{% if 'adoptopenjdk/openjdk/adoptopenjdk8' in cask_apps %}
export JAVA8="$(/usr/libexec/java_home -v 1.8)"
{% endif %}
export JAVA9="$(/usr/libexec/java_home -v 9)"
{% if 'adoptopenjdk/openjdk/adoptopenjdk11' in cask_apps %}
export JAVA11="$(/usr/libexec/java_home -v 11)"
{% endif %}
{% if 'openjdk' in cask_apps %}
export JAVA14="$(/usr/libexec/java_home -v 14)"
{% endif %}
export JAVA_HOME="$JAVA11"
export JRE_HOME="$JAVA_HOME/jre"
if [ -z "$(printf "${PATH}" | tr ':' '\n' | grep "^$JAVA_HOME/bin")" ]; then
	export PATH="$JAVA_HOME/bin:$PATH"
fi

{% if 'go' in homebrew_apps %}
# Go config
export GOPATH="$HOME/go"
export GOROOT=/usr/local/opt/go/libexec
if [ -z "$(printf "${PATH}" | tr ':' '\n' | grep "^$GOROOT/bin")" ]; then
	export PATH="$GOROOT/bin:$PATH"
fi
if [ -z "$(printf "${PATH}" | tr ':' '\n' | grep "^$GOPATH/bin")" ]; then
	export PATH="$GOPATH/bin:$PATH"
fi
{% endif %}

{% if 'maven' in homebrew_apps %}
# Maven config
export M2_HOME=/usr/local/opt/maven/libexec
export M2="$M2_HOME/bin"
{% endif %}

{% if 'gradle' in homebrew_apps %}
# Gradle config
export GRADLE_HOME=/usr/local/opt/gradle/libexec
{% endif %}

{% if 'groovysdk' in homebrew_apps %}
# Groovy config
export GROOVY_HOME=/usr/local/opt/groovysdk/libexec
{% endif %}

{% if 'android-sdk' in cask_apps %}
# Android config
export ANDROID_SDK_ROOT="$(brew --prefix)/share/android-sdk"
export ANDROID_HOME="$ANDROID_SDK_ROOT"
{% endif %}

{% if 'nvm' in homebrew_apps %}
# nvm config
export NVM_DIR="$HOME/.nvm"
[ -s "/usr/local/opt/nvm/nvm.sh" ] && . "/usr/local/opt/nvm/nvm.sh"  # This loads nvm
[ -s "/usr/local/opt/nvm/etc/bash_completion" ] && . "/usr/local/opt/nvm/etc/bash_completion"  # This loads nvm bash_completion
export HUSKY_SKIP_INSTALL=1
{% endif %}

{% if 'hab' in homebrew_apps %}
# hab config
eval "$(hab cli completers --shell bash)"
export HAB_AUTH_TOKEN="{{ hab_auth_token }}"
{% endif %}

{% if 'python' in homebrew_apps %}
# Python config
if command -v pip3 1>/dev/null 2>&1; then
	eval "$(pip3 completion --bash)"
fi
{% endif %}
{% if 'pyenv' in homebrew_apps %}
# Python pyenv config
#export WORKON_HOME=$HOME/.virtualenvs
export WORKON_HOME="$HOME/.venvs"
if command -v pyenv 1>/dev/null 2>&1; then
	eval "$(pyenv init -)"
fi
export PYENV_ROOT="$(pyenv root)"
{% endif %}
{% if 'pipenv' in homebrew_apps %}
# Python Pipenv config
if command -v pipenv 1>/dev/null 2>&1; then
	eval "$(pipenv --completion)"
fi
{% endif %}

# ansible config
export ANSIBLE_CONFIG="$HOME/.ansible.cfg"
{% if 'lastpass-cli' in homebrew_apps %}
export ANSIBLE_VAULT_PASSWORD_FILE="$HOME/.vault_pass.bash"
{% endif %}
{% if 'docker' in cask_apps or 'docker-edge' in cask_apps %}
export DOCKER_CONFIG_FILE="$HOME/.docker.yml"
{% endif %}

# Homebrew config
export HOMEBREW_GITHUB_API_TOKEN={{ homebrew_github_api_token }}
[[ -r "/usr/local/etc/profile.d/bash_completion.sh" ]] && . "/usr/local/etc/profile.d/bash_completion.sh"

# Show git branch & state in prompt
GIT_PS1_SHOWDIRTYSTATE=true
export PS1='[\h:\u \W$(__git_ps1)]\$ '

export EDITOR=/usr/local/bin/vim

export GPG_TTY="$(tty)"
#export SSH_AUTH_SOCK="$(gpgconf --list-dirs agent-ssh-socket)"
#gpgconf --launch gpg-agent
#export SSH_AUTH_SOCK="$HOME/.yubiagent/sock"

# use vi keybindings in bash
set -o vi

alias xml-format="XMLLINT_INDENT=$'\t' xmllint --format"
alias docker-images-by-size="docker images | sort -k7 -h"

if [ -d "${HOME}/.bash_profile.d" ]; then
	while IFS=	read -r; do
		printf 'sourcing file in bash profile: %s\n' "${REPLY}"
		source "${REPLY}"
	done < <(find "${HOME}/.bash_profile.d" -type f -iname '*.bash' | sort)
fi

